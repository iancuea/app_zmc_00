{% extends "core/base.html" %}
{% load static %}

{% block content %}

<h2>Cami√≥n {{ camion.patente }}</h2>

<hr>

<h3>Estado actual</h3>

{% if estado %}
    <p>
        <strong>Estado operativo:</strong>

        {% if estado.estado_operativo == "OPERATIVO" %}
            <span class="estado-ok">OPERATIVO</span>
        {% elif estado.estado_operativo == "EN_MANTENCION" %}
            <span class="estado-warning">EN MANTENCI√ìN</span>
        {% elif estado.estado_operativo == "FUERA_DE_SERVICIO" %}
            <span class="estado-danger">FUERA DE SERVICIO</span>
        {% else %}
            {{ estado.estado_operativo }}
        {% endif %}
    </p>

    <p><strong>Kilometraje actual:</strong> {{ estado.kilometraje }} km</p>

    {% if estado.observacion %}
        <p><strong>Observaci√≥n:</strong> {{ estado.observacion }}</p>
    {% endif %}
{% else %}
    <p>No hay estado actual registrado para este cami√≥n.</p>
{% endif %}

<hr>

<h3>Mantenci√≥n</h3>

{% with estado_mant=camion.estado_mantencion %}
    <p>
        <strong>Estado de mantenci√≥n:</strong>
        <span class="{{ estado_mant.css }}">
            {{ estado_mant.label }}
        </span>
    </p>

    {% if estado_mant.codigo == "VENCIDA" %}
        <p><strong>Urgencia:</strong> üî¥ Alta</p>
    {% elif estado_mant.codigo == "CRITICA" %}
        <p><strong>Urgencia:</strong> üü° Media</p>
    {% elif estado_mant.codigo == "OK" %}
        <p><strong>Urgencia:</strong> üü¢ Baja</p>
    {% else %}
        <p><strong>Urgencia:</strong> ‚Äî</p>
    {% endif %}
{% endwith %}

{% if mantenciones %}
    {% with ultima=mantenciones.0 %}
        <p><strong>Fecha √∫ltima mantenci√≥n:</strong> {{ ultima.fecha_mantencion }}</p>
        <p><strong>Kilometraje mantenci√≥n:</strong> {{ ultima.km_mantencion }} km</p>
        <p><strong>Pr√≥xima mantenci√≥n:</strong> {{ ultima.km_proxima_mantencion }} km</p>

        <p><strong>Kil√≥metros restantes:</strong>
            {% if ultima.km_restantes_calculados is None %}
                ‚Äî
            {% elif ultima.km_restantes_calculados <= 0 %}
                <span class="estado-danger">VENCIDA</span>
            {% elif ultima.km_restantes_calculados <= 1000 %}
                <span class="estado-warning">
                    {{ ultima.km_restantes_calculados }} km (PR√ìXIMA)
                </span>
            {% else %}
                <span class="estado-ok">
                    {{ ultima.km_restantes_calculados }} km
                </span>
            {% endif %}
        </p>
    {% endwith %}
{% else %}
    <p>No existen mantenciones registradas.</p>
{% endif %}

<hr>

<h3>Historial de mantenciones</h3>

<table class="tabla-camiones">
    <thead>
        <tr>
            <th>Fecha</th>
            <th>Kilometraje</th>
            <th>Pr√≥xima</th>
            <th>Taller</th>
            <th>Observaciones</th>
        </tr>
    </thead>
    <tbody>
        {% for m in mantenciones %}
            <tr>
                <td>{{ m.fecha_mantencion }}</td>
                <td>{{ m.km_mantencion }}</td>
                <td>{{ m.km_proxima_mantencion }}</td>
                <td>{{ m.taller }}</td>
                <td>{{ m.observaciones|default:"-" }}</td>
            </tr>
        {% empty %}
            <tr>
                <td colspan="5">Sin historial de mantenciones.</td>
            </tr>
        {% endfor %}
    </tbody>
</table>

<hr>

<a href="{% url 'camion_list' %}">‚Üê Volver al listado</a>


<hr>

<h3>¬øPor qu√© este cami√≥n est√° en este estado?</h3>

<ul>
    {% if estado and estado.estado_operativo == "FUERA_DE_SERVICIO" %}
        <li>
            üî¥ <strong>Estado operativo:</strong>
            El cami√≥n est√° <strong>fuera de servicio</strong>, por lo que no puede operar,
            independiente de su mantenci√≥n.
        </li>
    {% endif %}

    {% if estado and estado.estado_operativo == "EN_MANTENCION" %}
        <li>
            üü° <strong>Estado operativo:</strong>
            El cami√≥n se encuentra actualmente <strong>en mantenci√≥n</strong>.
        </li>
    {% endif %}

    {% with est=camion.estado_mantencion %}
        {% if est.codigo == "VENCIDA" %}
            <li>
                üî¥ <strong>Mantenci√≥n vencida:</strong>
                El cami√≥n <strong>super√≥ el kilometraje</strong> definido para su pr√≥xima mantenci√≥n.
            </li>

        {% elif est.codigo == "CRITICA" %}
            <li>
                üü° <strong>Mantenci√≥n cr√≠tica:</strong>
                Al cami√≥n le quedan <strong>menos de 1000 km</strong> para su pr√≥xima mantenci√≥n.
            </li>

        {% elif est.codigo == "OK" %}
            <li>
                üü¢ <strong>Mantenci√≥n al d√≠a:</strong>
                El cami√≥n a√∫n se encuentra dentro del rango de kilometraje permitido.
            </li>

        {% elif est.codigo == "SIN_DATOS" %}
            <li>
                ‚ö™ <strong>Sin informaci√≥n suficiente:</strong>
                No existen datos completos de mantenci√≥n o kilometraje para evaluar el estado.
            </li>
        {% endif %}
    {% endwith %}
</ul>
{% endblock %}