{% extends "core/base.html" %}
{% load static %}
{% load humanize %}

{% block content %}
<div class="container-detail-pro">
    <div class="detail-navigation">
        <div class="breadcrumb-pro">
            <a href="{% url 'camion_list' %}">Flota</a> 
            <span class="separator">/</span> 
            <span class="current">Detalle de Unidad</span>
        </div>
        <a href="{% url 'camion_list' %}" class="btn-secondary-pro">‚Üê Volver al listado</a>
    </div>

    <div class="detail-header-section">
        <h1 class="detail-title">Unidad Tracto <span class="patente-hero">{{ camion.patente }}</span></h1>
    </div>

    <div class="card-hero-pro {{ estado_mant.css }} {{ estado_mant.codigo }}">
        <div class="hero-main-info">
            <span class="hero-badge-label">Estado T√©cnico Tracto</span>
            <h2 class="hero-status-text">{{ estado_mant.label }}</h2>
            
            <ul class="hero-motivos-list">
                {% for motivo in estado_mant.motivos %}
                    <li>{{ motivo }}</li>
                {% empty %}
                    <li>‚úÖ Unidad operativa sin alertas pendientes</li>
                {% endfor %}
            </ul>
        </div>
        
        <div class="hero-stats-grid">
            <div class="hero-stat-box">
                <span class="stat-label">Kilometraje Actual</span>
                <span class="stat-value">{{ camion.estado_actual.kilometraje|default:0|intcomma }} <small>km</small></span>
            </div>
            {% if mantenciones %}
            <div class="hero-stat-box">
                <span class="stat-label">√öltima Mantenci√≥n</span>
                <span class="stat-value">{{ mantenciones.0.fecha_mantencion|date:"d M Y" }}</span>
            </div>
            {% endif %}
        </div>
    </div>

    <div class="grid-layout-pro">
        
        <div class="card-pro">
            <div class="card-header-pro">
                <h3>Situaci√≥n Operativa</h3>
            </div>
            <div class="card-body-pro">
                <div class="data-row">
                    <span class="data-label">Estado:</span>
                    <span class="badge-status {% if camion.estado_actual.estado_operativo == 'OPERATIVO' %}bg-success{% else %}bg-danger{% endif %}">
                        {{ camion.estado_actual.get_estado_operativo_display|default:"SIN DATOS" }}
                    </span>
                </div>
                <div class="data-row">
                    <span class="data-label">Base Actual:</span>
                    <span class="data-value">{{ camion.estado_actual.get_base_actual_display|default:"No asignada" }}</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Conductor:</span>
                    <span class="data-value">
                        {% if camion.estado_actual.conductor %}
                            {{ camion.estado_actual.conductor.nombre }} {{ camion.estado_actual.conductor.apellido }}
                        {% else %}
                            <span class="text-muted">Sin asignar</span>
                        {% endif %}
                    </span>
                </div>
                <div class="data-row">
                    <span class="data-label">Rol Flota:</span>
                    <span class="badge-outline">{{ camion.get_rol_operativo_display }}</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Marca / Modelo:</span>
                    <span class="data-value">{{ camion.marca|default:"" }} {{ camion.modelo|default:"S/D" }} ({{ camion.anio }})</span>
                </div>
            </div>
        </div>

        <div class="card-pro">
            <div class="card-header-pro">
                <h3>Remolque Vinculado</h3>
            </div>
            <div class="card-body-pro">
                {% if remolque_vinculado %}
                    <div class="trailer-active-box">
                        <div class="trailer-icon">üöö</div>
                        <div class="trailer-info">
                            <span class="trailer-patente">{{ remolque_vinculado.patente }}</span>
                            <span class="trailer-type">{{ remolque_vinculado.tipo_remolque|default:"Semirremolque" }}</span>
                        </div>
                    </div>
                    <a href="{% url 'remolque_detail' remolque_vinculado.id_remolque %}" class="btn-link-pro">Ver ficha t√©cnica ‚Üí</a>
                {% else %}
                    <div class="empty-state-pro">
                        <p>No tiene remolque asignado actualmente.</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="card-pro section-margin">
        <div class="card-header-pro">
            <h3>Documentaci√≥n Legal</h3>
        </div>
        <div class="table-container-minimal">
            <table class="table-minimal">
                <thead>
                    <tr>
                        <th>Documento</th>
                        <th>Vencimiento</th>
                        <th>Estado</th>
                        <th>Acci√≥n</th>
                    </tr>
                </thead>
                <tbody>
                    {% for doc in documentos %}
                    <tr class="doc-row state-{{ doc.estado|lower }}">
                        <td><strong>{{ doc.get_categoria_display }}</strong></td>
                        <td>{{ doc.fecha_vencimiento|default:"Indefinido" }}</td>
                        <td><span class="status-dot-label {{ doc.estado|lower }}">{{ doc.estado }}</span></td>
                        <td>
                            {% if doc.archivo %}
                                <a href="{{ doc.archivo.url }}" target="_blank" class="btn-action-small">Abrir PDF</a>
                            {% else %}
                                <span class="text-muted">No cargado</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}