{% extends "core/base.html" %}
{% load static %}
{% load humanize %}

{% block content %}
<div class="container-detail-pro">
    <div class="detail-navigation">
        <div class="breadcrumb-pro">
            <a href="{% url 'camion_list' %}">Flota</a> 
            <span class="separator">/</span> 
            <span class="current">Ficha de Remolque</span>
        </div>
        <a href="{% url 'camion_list' %}" class="btn-secondary-pro">‚Üê Volver al listado</a>
    </div>

    <div class="detail-header-section">
        <h1 class="detail-title">Unidad Remolque <span class="patente-hero">{{ remolque.patente }}</span></h1>
    </div>

    <div class="card-hero-pro {{ estado_mant.css|default:'estado-ok' }} {{ estado_mant.codigo|default:'OK' }}">
        <div class="hero-main-info">
            <span class="hero-badge-label">Estado T√©cnico Remolque</span>
            <h2 class="hero-status-text">{{ estado_mant.label }}</h2>
            
            <ul class="hero-motivos-list">
                {% for motivo in estado_mant.motivos %}
                    <li>{{ motivo }}</li>
                {% empty %}
                    <li>‚úÖ Equipo sin observaciones t√©cnicas pendientes</li>
                {% endfor %}
            </ul>
        </div>
        
        <div class="hero-stats-grid">
            <div class="hero-stat-box">
                <span class="stat-label">Kilometraje Acumulado</span>
                <span class="stat-value">{{ remolque.kilometraje_acumulado|default:0|intcomma }} <small>km</small></span>
            </div>
            {% if mantenciones %}
            <div class="hero-stat-box">
                <span class="stat-label">√öltimo Ingreso Taller</span>
                <span class="stat-value">{{ mantenciones.0.fecha_mantencion|date:"d M Y" }}</span>
            </div>
            {% endif %}
        </div>
    </div>

    <div class="grid-layout-pro">
        
        <div class="card-pro">
            <div class="card-header-pro">
                <h3>Especificaciones del Equipo</h3>
            </div>
            <div class="card-body-pro">
                <div class="data-row">
                    <span class="data-label">Tipo de Remolque:</span>
                    <span class="data-value">{{ remolque.tipo_remolque|default:"S/D" }}</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Configuraci√≥n de Ejes:</span>
                    <span class="data-value">{{ remolque.n_ejes }} ejes</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Capacidad de Carga:</span>
                    <span class="data-value">{{ remolque.capacidad_carga|intcomma }} kg</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Estado Operativo:</span>
                    <span class="badge-status {% if remolque.activo %}bg-success{% else %}bg-danger{% endif %}">
                        {{ remolque.get_estado_operativo_display }}
                    </span>
                </div>
            </div>
        </div>

        <div class="card-pro">
            <div class="card-header-pro">
                <h3>Tracto Asignado Actual</h3>
            </div>
            <div class="card-body-pro">
                {% if camion_vinculado %}
                    <div class="trailer-active-box">
                        <div class="trailer-icon">üöú</div>
                        <div class="trailer-info">
                            <span class="trailer-patente">{{ camion_vinculado.patente }}</span>
                            <span class="trailer-type">{{ camion_vinculado.modelo|default:"Unidad Tractora" }}</span>
                        </div>
                    </div>
                    <a href="{% url 'camion_detail' camion_vinculado.id_camion %}" class="btn-link-pro">Ver ficha del tracto ‚Üí</a>
                {% else %}
                    <div class="empty-state-pro">
                        <div class="empty-icon">üîì</div>
                        <p>Equipo desenganchado (Sin tracto asignado)</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="card-pro section-margin">
        <div class="card-header-pro">
            <h3>Documentaci√≥n y Certificados</h3>
        </div>
        <div class="table-container-minimal">
            <table class="table-minimal">
                <thead>
                    <tr>
                        <th>Categor√≠a</th>
                        <th>Vencimiento</th>
                        <th>Estado</th>
                        <th>Archivo</th>
                    </tr>
                </thead>
                <tbody>
                    {% for doc in documentos %}
                    <tr class="doc-row state-{{ doc.estado|lower }}">
                        <td><strong>{{ doc.get_categoria_display }}</strong></td>
                        <td>{{ doc.fecha_vencimiento|default:"Vigencia Permanente" }}</td>
                        <td><span class="status-dot-label {{ doc.estado|lower }}">{{ doc.estado }}</span></td>
                        <td>
                            {% if doc.archivo %}
                                <a href="{{ doc.archivo.url }}" target="_blank" class="btn-action-small">
                                    {% if ".pdf" in doc.archivo.name %}üìÑ PDF{% else %}üì∑ Imagen{% endif %}
                                </a>
                            {% else %}
                                <span class="text-muted">No cargado</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="4" class="empty-table-msg">No hay documentos registrados para esta unidad.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div class="card-pro">
        <div class="card-header-pro">
            <h3>Log de Intervenciones Mec√°nicas</h3>
        </div>
        <div class="table-container-minimal">
            <table class="table-minimal">
                <thead>
                    <tr>
                        <th>Fecha</th>
                        <th>KM Registro</th>
                        <th>Pr√≥xima Mantenci√≥n</th>
                        <th>Descripci√≥n / Observaciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for m in mantenciones %}
                    <tr>
                        <td>{{ m.fecha_mantencion|date:"d/m/Y" }}</td>
                        <td>{{ m.kilometraje|intcomma }} km</td>
                        <td>{{ m.km_proxima_mantencion|intcomma }} km</td>
                        <td><span class="text-truncate-pro">{{ m.descripcion|truncatechars:80 }}</span></td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="4" class="empty-table-msg">Sin registros de mantenci√≥n hist√≥ricos.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}