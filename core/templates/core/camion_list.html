{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Listado de Camiones</title>

    <!-- CSS -->
    <link rel="stylesheet" href="{% static 'core/css/camiones.css' %}">
</head>
<body>

<h1>Listado de Camiones</h1>

<!-- FILTRO Y ORDEN (backend, NO se toca) -->
<form method="get" style="margin-bottom: 1rem;">
    <label>Estado mantención:</label>
    <select name="estado">
        <option value="">Todos</option>
        <option value="VENCIDA">Vencida</option>
        <option value="CRITICA">Crítica</option>
        <option value="OK">OK</option>
        <option value="SIN_DATOS">Sin datos</option>
    </select>

    <label style="margin-left: 1rem;">Orden:</label>
    <select name="orden">
        <option value="">Normal</option>
        <option value="urgencia">Por urgencia</option>
    </select>

    <button type="submit">Aplicar</button>
</form>

<table class="tabla-camiones" id="tabla-camiones">
    <thead>
        <tr>
            <th>Patente</th>
            <th>Tipo</th>
            <th>Rol</th>
            <th>Base</th>
            <th>Activo</th>
            <th>Estado Operativo</th>
            <th>Mantención</th>
            <th>Conductor</th>
            <th>Motivos</th>
        </tr>
    </thead>

        <tbody>

        {% for grupo in camiones_por_base %}

            <!-- SEPARADOR DE BASE -->
            <tr class="separador-base">
                <td colspan="9">
                    BASE: {{ grupo.base|upper }}
                </td>
            </tr>

            {% for camion in grupo.camiones %}
            {% with estado=camion.estado_mantencion %}

            <tr
                class="{{ estado.css }}"
                data-camion-id="{{ camion.id_camion }}"
            >

                <!-- Patente -->
                <td>
                    <a href="{% url 'camion_detail' camion.id_camion %}">
                        {{ camion.patente }}
                    </a>
                </td>

                <!-- Tipo -->
                <td>{{ camion.tipo_camion }}</td>

                <!-- Rol -->
                <td>{{ camion.rol_operativo }}</td>

                <!-- Base -->
                <td>
                    {% if camion.estado_actual %}
                        {{ camion.estado_actual.get_base_actual_display }}
                    {% else %}
                        —
                    {% endif %}
                </td>

                <!-- Activo -->
                <td>{{ camion.activo|yesno:"Sí,No" }}</td>

                <!-- Estado operativo -->
                <td>
                    {% if camion.estado_actual %}
                        {{ camion.estado_actual.estado_operativo }}
                    {% else %}
                        —
                    {% endif %}
                </td>

                <!-- Mantención -->
                <td class="estado-mantencion">
                    {{ estado.label }}
                </td>

                <!-- Conductor -->
                <td>
                    {% if camion.estado_actual and camion.estado_actual.conductor %}
                        {{ camion.estado_actual.conductor }}
                    {% else %}
                        —
                    {% endif %}
                </td>

                <!-- Motivos (JS / JSON) -->
                <td class="motivos">
                    Cargando...
                </td>

            </tr>

            {% endwith %}
            {% endfor %}

        {% empty %}
            <tr>
                <td colspan="9">No hay camiones registrados.</td>
            </tr>

        {% endfor %}

    </tbody>
</table>

<!-- JS -->
<script src="{% static 'core/js/camiones.js' %}"></script>

</body>
</html>
