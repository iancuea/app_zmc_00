{% extends 'mantenciones/base.html' %}
{% load static %}

{% block title %}Crear Inspecci√≥n | ZMC{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="card shadow">
        <div class="card-header bg-dark text-white">
            <h3 class="mb-0">üìã Nueva Inspecci√≥n de Flota</h3>
        </div>
        <div class="card-body">
            <form id="inspeccion-form" method="post">
                {% csrf_token %}

                <div class="row mb-4">
                    <div class="col-md-6">
                        <label class="form-label fw-bold">Tipo de Inspecci√≥n *</label>
                        {{ form.tipo_inspeccion }}
                    </div>
                    <div class="col-md-6">
                        <label class="form-label fw-bold">Patente Cami√≥n *</label>
                        {{ form.vehiculo }}
                    </div>
                </div>

                <div id="datos-autocompletados" class="row mb-4 p-3 bg-light border rounded" style="display: none;">
                    <div class="col-md-4">
                        <label class="text-muted small">Lugar Actual:</label>
                        <input type="text" id="lugar-inspeccion" class="form-control form-control-sm" disabled>
                    </div>
                    <div class="col-md-4">
                        <label class="text-muted small">Conductor Asignado:</label>
                        <input type="text" id="conductor-nombre" class="form-control form-control-sm" disabled>
                    </div>
                    <div id="seccion-remolque" class="col-md-4" style="display: none;">
                        <label class="text-muted small">Remolque:</label>
                        <input type="text" id="remolque-patente" class="form-control form-control-sm" disabled>
                        <input type="hidden" name="remolque" id="id_remolque">
                    </div>
                </div>

                <div class="row mb-4">
                    <div class="col-md-6">
                        <label class="form-label fw-bold">Kilometraje Actual (Od√≥metro) *</label>
                        {{ form.km_registro }}
                    </div>
                    <div class="col-md-6">
                        <label class="form-label fw-bold">Responsable de Inspecci√≥n *</label>
                        {{ form.responsable }}
                    </div>
                </div>

                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="form-check form-switch custom-switch">
                            {{ form.es_apto_operar }}
                            <label class="form-check-label fw-bold" for="id_es_apto_operar">¬øUnidad apta para operar?</label>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-check form-switch custom-switch">
                            {{ form.renov√≥_aceite }}
                            <label class="form-check-label fw-bold" for="id_renov√≥_aceite">¬øSe realiz√≥ cambio de aceite motor?</label>
                        </div>
                    </div>
                </div>

                <div class="mb-4">
                    <label class="form-label fw-bold">Observaciones Generales</label>
                    {{ form.observaciones }}
                </div>

                <hr class="my-5">

                <div class="checklist-container">
                    <h4 class="mb-4">üìù Items de Inspecci√≥n</h4>
                    <div id="categorias-checklist">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i> Seleccione un cami√≥n y tipo de inspecci√≥n para cargar los puntos de revisi√≥n.
                        </div>
                    </div>
                </div>

                <input type="hidden" id="resultados-checklist" name="resultados_checklist" value="[]">

                <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-5">
                    <button type="button" onclick="llenarTodo()" class="btn btn-outline-warning me-md-2">
                        ‚ö° Llenar R√°pido (Prueba)
                    </button>
                    <a href="{% url 'camion_list' %}" class="btn btn-secondary me-md-2">Cancelar</a>
                    <button type="submit" class="btn btn-primary btn-lg">
                        <i class="fas fa-save"></i> Guardar y Generar PDF
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'mantenciones/js/inspeccion.js' %}"></script>
{% endblock %}

{% block extra_css %}
<style>
    .custom-switch .form-check-input { width: 3em; height: 1.5em; cursor: pointer; }
    .card-header { border-bottom: 2px solid #ffcc00; } /* Un toque de color ZMC */
    .item-radio { transform: scale(1.3); cursor: pointer; }
    .table thead th { background-color: #f8f9fa; text-transform: uppercase; font-size: 0.8rem; }
</style>
{% endblock %}